{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Tasks Array",
  "description": "Array of tasks for a jons-plan phase",
  "type": "array",
  "items": {
    "type": "object",
    "required": ["id", "description", "status"],
    "additionalProperties": false,
    "properties": {
      "id": {
        "type": "string",
        "pattern": "^[a-z0-9-]+$",
        "description": "Unique task identifier (lowercase alphanumeric with hyphens)"
      },
      "description": {
        "type": "string",
        "minLength": 1,
        "description": "What the task accomplishes"
      },
      "status": {
        "type": "string",
        "enum": ["todo", "in-progress", "done", "blocked"],
        "description": "Task status"
      },
      "type": {
        "type": "string",
        "enum": ["cache-reference", "prototype"],
        "description": "Optional task type for special handling"
      },
      "steps": {
        "type": "array",
        "items": { "type": "string" },
        "description": "Ordered list of steps to complete the task"
      },
      "parents": {
        "type": "array",
        "items": { "type": "string" },
        "description": "Task IDs that must complete before this task"
      },
      "context_artifacts": {
        "type": "array",
        "items": { "type": "string" },
        "description": "Artifact names to include from phase history (e.g., [\"request\", \"design\"])"
      },
      "subagent": {
        "type": "string",
        "description": "Agent type for task execution (e.g., \"Explore\", \"general-purpose\")"
      },
      "subagent_prompt": {
        "type": "string",
        "description": "Additional context/instructions for the subagent"
      },
      "model": {
        "type": "string",
        "enum": ["sonnet", "haiku", "opus"],
        "description": "Model override for this task"
      },
      "question": {
        "type": "string",
        "description": "For prototype tasks: the question being answered"
      },
      "hypothesis": {
        "type": "string",
        "description": "For prototype tasks: expected outcome"
      },
      "inject_project_context": {
        "type": "boolean",
        "description": "Include project CLAUDE.md in task prompt (default: false)"
      },
      "locks": {
        "type": "array",
        "items": { "type": "string" },
        "description": "Lock names for exclusive access. Tasks sharing locks are serialized. Can be files, tools, or abstract resources (e.g., 'cargo', 'browser', 'src/config.rs')."
      },
      "cache_id": {
        "type": "integer",
        "description": "Cache entry ID for cache-reference type tasks"
      },
      "prompt_file": {
        "type": "string",
        "description": "Plugin prompt file to inject (e.g., 'slop-detection' loads prompts/slop-detection.md)"
      },
      "executor": {
        "type": "string",
        "enum": ["task-tool", "codex-cli", "gemini-cli"],
        "default": "task-tool",
        "description": "Execution method: task-tool (Claude Code Task), codex-cli (via codex exec CLI), or gemini-cli (via gemini CLI)"
      },
      "inject_phase_prompt": {
        "type": "boolean",
        "default": false,
        "description": "When true, inject the current phase's prompt into the task prompt"
      }
    }
  }
}
